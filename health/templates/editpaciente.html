<!DOCTYPE html>
<html>

     {% include "head.html" %}

  <body>
    <div class="page form-page">



     {% include "header.html" %}





      <div class="page-content d-flex align-items-stretch"> 
 

       {% include "sidenav.html" %}



        <div class="content-inner">
          <!-- Page Header-->
          <header class="page-header">
            <div class="container-fluid">
              <h2 class="no-margin-bottom">Editar Paciente</h2>
            </div>
          </header>

          <ul class="breadcrumb">
            <div class="container-fluid">
              <li class="breadcrumb-item"><a href="/paciente">Pacientes</a></li>
              <li class="breadcrumb-item active">{{paciente.nombre}}</li>
            </div>
          </ul>

          <br>

          <!-- Forms Section-->
          <section class="forms"> 
            <div class="container-fluid">
              <div class="row">

       
             
                <!-- Form Elements -->
                <div class="col-lg-6">
                  <div class="card">
                    <div class="card-close">
                      <div class="dropdown">
                        <button type="button" id="closeCard" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-ellipsis-v"></i></button>
                        <div aria-labelledby="closeCard" class="dropdown-menu has-shadow"><a href="/static/#" class="dropdown-item remove"> <i class="fa fa-times"></i>Close</a><a href="/static/#" class="dropdown-item edit"> <i class="fa fa-gear"></i>Edit</a></div>
                      </div>
                    </div>


                    <div class="card-header d-flex align-items-center">
                      <h3 class="h4">Datos de Paciente</h3>
                    </div>
                    <div class="card-body">



                        <form class="form-horizontal" action="/editpaciente/{{id_paciente}}" method="POST">


                        {% csrf_token %}

                        {% for field in form %}


                          <div class="form-group row">
                              

                              <div class="col-sm-3 form-control-label">{{ field.label_tag }}</div>

                              <div class="col-sm-9">{{ field.errors }} {{ field }}

                              {% if field.help_text %}
                              <p class="help">{{ field.help_text|safe }}</p>
                              {% endif %}

                              </div>
                               
                              
                              
                          </div>


                       {% endfor %}


                        <div class="line"></div>
                        <div class="form-group row">
                          <div class="col-sm-4 offset-sm-3">
                            
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                          
                          </div>
                          </div>
                      

                        </form>

        </div>
      </div>
    </div>


                <div class="col-lg-6">
                  <div class="client card">
                    <div class="card-close">
                      <div class="dropdown">
                        <button type="button" id="closeCard" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-ellipsis-v"></i></button>
                        <div aria-labelledby="closeCard" class="dropdown-menu has-shadow"><a href="#" class="dropdown-item remove"> <i class="fa fa-times"></i>Close</a><a href="#" class="dropdown-item edit"> <i class="fa fa-gear"></i>Edit</a></div>
                      </div>
                    </div>
                    <div class="card-body text-center">
                      <div class="client-avatar"><img src="{{paciente.foto}}" alt="..." class="img-fluid">
                        <div class="status bg-green"></div>
                      </div>
                      <div class="client-title">
                        <h3>{{a.nombre}}</h3><span>Paciente</span>
                      </div>
                      <div class="client-info">
                        <div class="row">
                          <div class="col-4"><strong>20</strong><br><small>Photos</small></div>
                          <div class="col-4"><strong>54</strong><br><small>Videos</small></div>
                          <div class="col-4"><strong>235</strong><br><small>Tasks</small></div>
                        </div>
                      </div>
                      <div class="client-social d-flex justify-content-between"><a href="#" target="_blank"><i class="fa fa-facebook"></i></a><a href="#" target="_blank"><i class="fa fa-twitter"></i></a><a href="#" target="_blank"><i class="fa fa-google-plus"></i></a><a href="#" target="_blank"><i class="fa fa-instagram"></i></a><a href="#" target="_blank"><i class="fa fa-linkedin"></i></a></div>
                    </div>


                    
                       <br>

                    <div class="card-body text-center">

                     <div class="row"><div class="col-md-12"><button class='btn btn-primary' id="startbutton">Toma la foto</button></div></div>
                     <br>
                      
                      <div class="row">


                        
                        <div class="col-md-6"><video id="video"></video></div>
                        <div class="col-md-6"><canvas id="canvas"></canvas></div>

 

                      </div>


                    </div>
                  </div>


                     <!-- Historial de atenciones -->
                          <div class="col-lg-12 col-md-12">
                            <div class="recent-activities card">
                              <div class="card-close">
                                <div class="dropdown">
                                  <button type="button" id="closeCard" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-ellipsis-v"></i></button>
                                  <div aria-labelledby="closeCard" class="dropdown-menu has-shadow"><a href="#" class="dropdown-item remove"> <i class="fa fa-times"></i>Close</a><a href="#" class="dropdown-item edit"> <i class="fa fa-gear"></i>Edit</a></div>
                                </div>
                              </div>
                              <div class="card-header">
                                <h3 class="h4">Historial de atenciones de {{paciente.nombre}}</h3>
                              </div>
                              <div class="card-body no-padding">


                                {% for p in atencion %}

                                <div class="item">
                                  <div class="row">
                                    <div class="col-4 date-holder text-right">
                                      <div class="icon"><i class="icon-clock"></i></div>
                                      <div class="date"> <span>{{p.fecha}}</span><span class="text-info"></span></div>
                                    </div>
                                    <div class="col-8 content">
                                      <h5>{{p.medico.nombre}}</h5>
                                      <p>{{p.descripcion}}</p>
                                    </div>
                                  </div>
                                </div>

                                 {% endfor %}
                               
                                
                              </div>
                            </div>
                          </div>


                </div>

                     <!-- Hstorial de Citas -->
                            <div class="col-lg-6">
                              <div class="daily-feeds card"> 
                                <div class="card-close">
                                  <div class="dropdown">
                                    <button type="button" id="closeCard" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-ellipsis-v"></i></button>
                                    <div aria-labelledby="closeCard" class="dropdown-menu has-shadow"><a href="#" class="dropdown-item remove"> <i class="fa fa-times"></i>Close</a><a href="#" class="dropdown-item edit"> <i class="fa fa-gear"></i>Edit</a></div>
                                  </div>
                                </div>
                                <div class="card-header">
                                  <h3 class="h4">Historial de citas de {{paciente.nombre}}</h3>
                                </div>
                                <div class="card-body no-padding">
                                  <!-- Item-->

                                  {% for p in citas %}

                                  <div class="item">
                                    <div class="feed d-flex justify-content-between">
                                      <div class="feed-body d-flex justify-content-between"><a href="#" class="feed-profile"><img src="https://xiencias.com/{{p.medico.foto}}" alt="person" class="img-fluid rounded-circle"></a>
                                        <div class="content">
                                          <h5></h5><span>{{p.descripcion}} </span>
                                          <div class="full-date"><small>{{p.start}}</small></div>
                                        </div>
                                      </div>
                                      <div class="date text-right"><small>{{p.medico.nombre}}</small></div>
                                    </div>
                                  </div>

                                  {% endfor %}
                                
                                 
                                </div>
                              </div>
                            </div>



      <!--cambio fin--->
    <!-- Javascript files-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="/static/js/tether.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"> </script>
    <script src="/static/js/jquery.validate.min.js"></script>
    <script src="/static/js/front.js"></script>


                          <script type="text/javascript">
                        
                        (function() {

                            var streaming = false,
                                video        = document.querySelector('#video'),
                                canvas       = document.querySelector('#canvas'),
                                photo        = document.querySelector('#photo'),
                                startbutton  = document.querySelector('#startbutton'),
                                width = 220,
                                height = 0;

                            navigator.getMedia = ( navigator.getUserMedia ||
                                                   navigator.webkitGetUserMedia ||
                                                   navigator.mozGetUserMedia ||
                                                   navigator.msGetUserMedia);

                            navigator.getMedia(
                              {
                                video: true,
                                audio: false
                              },
                              function(stream) {
                                if (navigator.mozGetUserMedia) {
                                  video.mozSrcObject = stream;
                                } else {
                                  var vendorURL = window.URL || window.webkitURL;
                                  video.src = vendorURL.createObjectURL(stream);
                                }
                                video.play();
                              },
                              function(err) {
                                console.log("An error occured! " + err);
                              }
                            );



                            video.addEventListener('canplay', function(ev){
                              if (!streaming) {
                                height = video.videoHeight / (video.videoWidth/width);
                                video.setAttribute('width', width);
                                video.setAttribute('height', height);
                                canvas.setAttribute('width', width);
                                canvas.setAttribute('height', height);
                                streaming = true;
                              }
                            }, false);

                            function takepicture() {
                              canvas.width = width;
                              canvas.height = height;
                              canvas.getContext('2d').drawImage(video, 0, 0, width, height);
                              var data = canvas.toDataURL('image/png');


                             
                            var todo={

                                'archivo':data
                            }

                            cod_pac = '{{paciente.id}}'


                            console.log('codigo de paciente','{{paciente.id}}')



                            var fd = new FormData();

                            fd.append('file', data);

                            

                                $.ajax({
                                  url: '/uploadfoto/'+cod_pac,
                                  data: fd,
                                  type: 'POST',
                                  contentType: false, // NEEDED, DON'T OMIT THIS (requires jQuery 1.6+)
                                  processData: false, // NEEDED, DON'T OMIT THIS
                                  // ... Other options like success and etc
                              }).done(function( html ) {
                                location.reload()
                              });

                            }

                            


                           

                            startbutton.addEventListener('click', function(ev){
                                takepicture();
                              ev.preventDefault();
                            }, false);

                          })();

                      </script>

          </div>

        </div>



      </section>

    </div>

  </div>

       {% include "footer.html" %}

  </body>
</html>